<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Send an Email</title>
  <link rel="icon" type="image/x-icon" href="/imgs/icon.png">
  <meta name="description" content="Send an email using Forwarded.">
  <meta name="keywords" content="Email">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Fragment+Mono:ital@0;1&display=swap');
  </style>
  <link href="/style.css" type="text/css" rel="stylesheet">
</head>
<body>
  <div class="padded">
    <h1>Send an Email</h1>
    <p>Select how youâ€™d like to email <strong id="recipient"></strong>.</p>

    <div class="email-options">
      <a id="def"><img src="/imgs/icon.png" alt="Default App" style="transform: rotate(-90deg)"><br>Default App</a>
      <a id="g"><img src="/imgs/webmail/gmail.png" alt="Gmail"><br>Gmail</a>
      <a id="o"><img src="/imgs/webmail/outlook.png" alt="Outlook"><br>Outlook</a>

      <a onClick="fwddCopy()" id="c">
        <img src="/imgs/copy.png" alt="Copy to Clipboard"><br>Copy To Clipboard
      </a>

      <a id="contactLink">
        <img style="transform: rotate(90deg)" src="/imgs/icon.png" alt="Contact Link"><br>Add To Contacts
      </a>
    </div>
  </div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const e = urlParams.get('e');

    // Sanitize (allow @ now)
    const sanitizedE = e ? e.replace(/[^a-zA-Z0-9._@+-]/g, '') : null;

    if (sanitizedE) {
      const email = sanitizedE;
      document.getElementById("recipient").textContent = email;
      history.replaceState({}, '', '/');

      window.addEventListener("DOMContentLoaded", () => {
        document.getElementById("def").href = "mailto:" + email;
        document.getElementById("g").href = "https://mail.google.com/mail/?view=cm&to=" + email;
        document.getElementById("o").href = "https://outlook.live.com/mail/0/deeplink/compose/?to=" + email;

        // Contact link button
        document.getElementById("contactLink").href =
          "https://contact.fwdd.org/?e=" + encodeURIComponent(email);
      });
    } else {
      window.location.href = "https://fwdd.org/";
    }

    function fwddCopy() {
      navigator.clipboard.writeText(sanitizedE);
    }
  </script>
</body>
</html>





